@model Hallo_Doc.Entity.ViewModel.Schedule;
@{
    ViewData["Title"] = "Scheduling";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<style>
    thead{
        text-decoration:none;
        background-color: #343a40;
        color:white;
    }
    th a {
        text-decoration: none;
        color: white;
    }

    td a {
        text-decoration: none;
        color: black;
    }
</style>
<div>
    @Html.Partial("_CreateShift")
</div>
<body class="bg-light" id="tableContent">

    <div class="container mt-5">
        <div class="flex-row d-flex mt-5 mb-3 justify-content-between">
            <h4 style="font-weight:bold;">Scheduling</h4>

            <a class="btn btn-outline-info out back" asp-action="Admin_Dashboard" asp-controller="Admin">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0" />
                </svg> Back
            </a>
        </div>
        <div class="flex-row d-flex mt-3 mb-3 justify-content-between">
            <div class="form-group col-lg-4 col-md-6 col-sm-12">
            <select class="form-select" id="SelectedRegion" name="RegionId" asp-items="@(new SelectList(ViewBag.Region,"RegionId","Name"))">
                <option value="">All Regions</option>
            </select>
            </div>
            <ul>
                <li class="d-inline">
                    <a class="btn btn-info text-white" asp-action="MDOnCall" asp-controller="Admin">
                        <span class="dash-btn">Providers On Call</span>
                    </a>
                </li>
                <li class="d-inline">
                    <a class="btn btn-info text-white" asp-action="RequestedShift" asp-controller="Admin">
                        <span class="dash-btn">Shift For Review</span>
                    </a>
                </li>
                <li class="d-inline">
                    <button type="button" class="btn btn-info text-white" data-bs-toggle="modal" data-bs-target="#createShiftModel">
                        <span class="dash-btn">Add New Shift</span>
                    </button>
                </li>
            </ul>
        </div>
        <div class="flex-row d-flex mt-3 mb-3">
            <h5 id="caldate"></h5>
        </div>
        <div class="g-2" style="display:flex; justify-content:flex-end;">
            <button type="button" class="me-2 bg-light border-0" style="display:flex; align-items:center">
                <i class="shift" style="background-color: pink; border-color: deeppink"></i>
                <span style="margin-left:5px"> Panding Shifts</span>
            </button>
            <button type="button" class="me-2 bg-light border-0" style="display:flex; align-items:center">
                <i class="shift" style="background-color: lightgreen; border-color: darkgreen"></i>
                <span style="margin-left:5px"> Approved Shifts</span>
            </button>
        </div>
        <div class="flex-row d-flex mt-3 mb-3 justify-content-between">
           <ul>
                <li class="d-inline">
                    <button type="button" id="prev" class="btn btn-info text-white" style="border-radius:50%"><i class="fa fa-angle-left" aria-hidden="true"></i></button>
                </li>
                <li class="d-inline">
                    <button class="btn" id="calendarIconBtn" onclick="picker.show(); return false;">
                        <i class="fa fa-calendar" id="calendar-icon" style="color:gray"></i>
                    </button> 
                </li>
                <li class="d-inline">
                    <button type="button" id="nxt" class="btn btn-info text-white" style="border-radius:50%"><i class="fa fa-angle-right" aria-hidden="true"></i></button>
                </li>
           </ul>
            <ul>
                <li class="d-inline">
                    <button type="button" class="btn btn-mode" id="dateview">Day</button>
                </li>
                <li class="d-inline">
                    <button type="button" class="btn btn-mode" id="weekview"> Week </button>
                </li>
                <li class="d-inline">
                    <button type="button" class="btn btn-mode" id="monthview">Month</button>
                </li>
            </ul>
        </div>
  <div id="calendar"></div>
    </div>
</body>
<script src='https://cdn.jsdelivr.net/npm/moment@2.30.1/min/moment.min.js'></script>
<script src="~/js/index.global.js"></script>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.11/index.global.min.js'></script>
<script>

    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            themeSystem: 'bootstrap5',
            initialView: 'resourceTimelineDay',
            aspectRatio: 1.8,
            scrollTime: '00:00',
            headerToolbar: false,
            editable: true,
            selectable: true,
            resourceAreaHeaderContent: 'Physicians',
            views: {
                resourceTimelineWeek: {
                    slotDuration: { days: 1 },
                    slotLabelFormat: { weekday: 'short', day: 'numeric', week: 'long' },
                },
            },
            displayEventTime: true,
            eventDisplay: 'block',
            dayMaxEvents: 1,
            eventClick: function (event, jsEvent, view) {
                ViewShift(event.event.id);
                //ViewShift();
            }
        });
        calendar.render();
        showDate();
        document.getElementById('prev').addEventListener('click', function () {
            calendar.prev();
            showDate();
        });
        document.getElementById('nxt').addEventListener('click', function () {
            calendar.next();
            showDate();
        });
        document.getElementById('dateview').addEventListener('click', function () {
            calendar.changeView('resourceTimelineDay');
            showDate();
        });
        document.getElementById('weekview').addEventListener('click', function () {
            calendar.changeView('resourceTimelineWeek');
            showDate();
        });
        document.getElementById('monthview').addEventListener('click', function () {
            calendar.changeView('dayGridMonth');
            showDate();
        });
        function showDate() {
            var view = calendar.view;
            document.getElementById('caldate').innerHTML = view.title;
            ProviderData();
            EventData();
        }
        function ProviderData() {
            region = $("#SelectedRegion").val();
            console.log(region);
            var response;
            $.ajax({
                type: "GET",
                url: "PhysicianCalender",
                data: {
                    RegionId: region
                },
                dataType: 'json',
                success: function (response) {
                    console.log(response);
                    calendar.getResources().forEach(function (resource) {
                        resource.remove();
                    });
                    response.forEach(function (physician) {
                        var fullName = physician.firstName + ' ' + physician.lastName;
                        calendar.addResource({
                            id: physician.physicianId,
                            title: fullName
                        });
                    });
                },
            });
        }
        function EventData() {
            $.ajax({
                type: "GET",
                url: "EventShift",
                
                dataType: 'json',
                success: function (response) {
                    console.log(response);
                    calendar.removeAllEvents();
                    response.forEach(function (e) {
                        var event = {
                            id: e.shiftId,
                            title: e.physicianName + "\n" + e.startTime+ "-" + e.endTime,
                            start: e.start,
                            end: e.end,
                            backgroundColor: e.color,
                            color: e.border,
                            textColor: "Black",
                            resourceId: e.physicianId,
                        };
                      
                        calendar.addEvent(event);
                    });
                },
            });
            calendar.setOption('eventContent', function (arg) {
                var status = arg.event.extendedProps.status;

                var content = document.createElement('div');
             
                if (calendar.view.type === 'resourceTimelineWeek' || calendar.view.type === 'dayGridMonth') {
                    content.innerText = arg.event.title;
                }
                else if (calendar.view.type === 'resourceTimelineDay')
                {
                    content.innerText = "Shift";
                }
                return { domNodes: [content] };
            });
        }
    });
</script>

@* <script src="/js/daypilot-all.min.js"></script>
<script type="text/javascript">
    var picker = new DayPilot.DatePicker({
        target: 'start',
        pattern: 'yyyy-MM-dd',
        onTimeRangeSelected: function (args) {
            document.getElementById('selectedDate').innerText = args.start.toString("dddd, MMMM dd, yyyy");
        }
    });
</script> *@
